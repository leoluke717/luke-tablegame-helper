# 桌游助手产品需求文档（v2.1 修改版）

## 文档信息

| 项目 | 详情 |
|------|------|
| **产品名称** | 桌游助手 |
| **目标游戏** | 屁者先知 |
| **文档版本** | v2.1（修改版） |
| **创建日期** | 2025-11-13 |
| **产品定位** | 网页端桌游主持人助手（简化版） |

---

## 1. 产品概述

### 1.1 产品背景

桌游助手网页在"屁者先知"游戏中充当主持人的角色，通过数字化手段辅助游戏进行，自动管理游戏流程、揭示场景牌、判定胜负，并提供特殊功能支持。

### 1.2 产品目标

- **主要目标**：替代传统桌游主持人，实现自动化游戏流程管理
- **次要目标**：
  - 降低游戏组织难度
  - 减少人为错误
  - 提升游戏体验
  - 支持多人在线协作

---

## 2. 用户角色定义

### 2.1 房主（Host）

**定义**：游戏的创建者和最高权限拥有者，同时也是玩家之一

**职责**：
- 创建游戏房间
- 设置游戏参数（有屁牌配置）
- 控制游戏进程
- 管理玩家

**权限**：
- ✅ 揭示场景牌（**按顺序 1F->8F**）
- ✅ 玩家出局操作
- ✅ 查看所有场景牌内容
- ✅ 游戏开始/结束控制

**特殊按钮**：
1. **揭示下一楼层按钮** - 按顺序揭示1F-8F的场景牌
2. **出局按钮** - 选择并移除一个玩家
3. **结算按钮** - （在4张有屁牌揭示后出现）

### 2.2 屁者（Assassin）

**定义**：拥有特殊身份的玩家

**职责**：
- 在身份选择阶段选择此身份
- 试图消灭所有乘客

**权限**：
- ✅ 偷偷查看所有场景牌内容（隐藏入口）
- ✅ 参与正常游戏流程

**特殊入口**：
- 独立的"查看牌库"入口
- 入口位置隐蔽，不被其他玩家察觉
- 界面提示：仅自己可见

### 2.3 乘客（Passenger）

**定义**：普通游戏玩家

**职责**：
- 在身份选择阶段选择此身份
- 试图存活到最后

**权限**：
- ✅ 参与正常游戏流程
- ✅ 查看自己相关的信息
- ❌ 无法查看未揭示的场景牌
- ❌ 无特殊按钮

---

## 3. 功能需求清单

### 3.1 核心功能

#### 3.1.1 游戏初始化

**功能描述**：创建游戏房间并完成初始设置

**优先级**：P0（必须）

**功能点**：
- [ ] 创建房间（生成唯一房间ID）
- [ ] 玩家加入房间
- [ ] 房主设置有屁牌配置（4张有屁牌中小屁与大屁的数量）
- [ ] 身份选择阶段（玩家选择：乘客或屁者）
- [ ] 生成8张场景牌（4张无屁 + 4张有屁）
- [ ] 随机抽取大屁牌种类

**验收标准**：
- ✅ 房间ID唯一且可分享
- ✅ 房主可设置小屁/大屁数量（总和=4）
- ✅ 所有玩家完成身份选择后才可开始游戏
- ✅ 场景牌生成符合设定（小屁/大屁数量正确）

#### 3.1.2 场景牌管理

**功能描述**：管理8张场景牌的展示

**优先级**：P0（必须）

**卡牌分类**：

| 类型 | 名称 | 原文效果 |
|------|------|----------|
| **无屁** | 无屁 | 无效果 |
| **小屁** | 有屁 | 对所有玩家造成1点伤害 |
| **大屁** | 有连环屁 | 对所有玩家造成1点伤害，若上1张牌为小屁牌，则本次伤害+1，若下1张牌为小屁牌，则该小屁牌伤害+1（相邻牌需为小屁牌） |
| **大屁** | 有蔫儿屁 | 对所有玩家造成1点伤害，并使下1张无屁牌视为"对所有玩家造成1点伤害"的小屁牌。若4张无屁牌均已翻开，则本次伤害不可防御 |
| **大屁** | 有臭屁 | 对所有玩家造成2点伤害 |
| **大屁** | 有彩虹屁 | 对所有押牌玩家造成1点不可防御的伤害。对所有空押玩家造成2点伤害 |
| **大屁** | 有闷屁 | 对所有玩家造成1点伤害，对所有空押玩家造成3点伤害 |

**功能点**：
- [ ] 场景牌牌库生成（4张无屁 + 指定数量的有屁牌）
- [ ] 牌面内容存储（仅房主和屁者可查看全部）
- [ ] **揭示顺序管理（强制 1F→8F）**
- [ ] **屁牌原文展示**（展示卡牌效果原文，不计算伤害）
- [ ] **大屁牌点击交互**（点击名称显示悬浮效果）

#### 3.1.3 胜负判定

**功能描述**：自动判定游戏结束和获胜方

**优先级**：P0（必须）

**胜利条件（按优先级判定）**：

1.  **立即判定（玩家出局时触发）**
    * **乘客胜利**：所有屁者均已出局。
    * **屁者胜利**：所有乘客均已出局。

2.  **终局判定（当房主点击‘结算’按钮时触发）**
    * **（触发条件：所有4张有屁牌均揭示后，‘揭示’按钮变为‘结算’按钮）**
    * **屁者胜利**：存活的屁者数量 ≥ 存活的乘客数量。
    * **乘客胜利**：存活的屁者数量 < 存活的乘客数量。

**功能点**：
- [ ] 实时监控玩家出局状态
- [ ] 实时监控有屁牌揭示进度
- [ ] 身份统计（屁者/乘客数量）
- [ ] 胜利条件自动判定
- [ ] 胜负结果展示

**验收标准**：
- ✅ 满足任一胜利条件时立即判定（**阵营全灭优先**）。
- ✅ 4张有屁牌揭示前，仅判定阵营全灭。
- ✅ **4张有屁牌揭示后，房主点击“结算”按钮，才启用**玩家数量对比判定。
- ✅ 展示详细的胜利原因。

#### 3.1.4 特殊权限管理

**功能描述**：管理不同角色的特殊权限

**优先级**：P1（重要）

**功能点**：

1. **房主权限**
   - [ ] **“揭示下一楼层”** 按钮（电梯按键UI，按 1F->8F 顺序）
   - [ ] **“结算”** 按钮（4张有屁牌揭示后出现）
   - [ ] **“出局”** 按钮（带确认弹窗）

2. **屁者权限**
   - [ ] 隐藏场景牌查看入口
   - [ ] 场景牌内容查看
   - [ ] 仅自己可见的提示

3. **系统权限**
   - [ ] 身份验证（玩家无法查看他人身份）
   - [ ] 出局玩家身份保密
   - [ ] 自动判定权限

### 3.2 辅助功能

#### 3.2.1 玩家管理

**功能描述**：管理房间内玩家

**优先级**：P1（重要）

**功能点**：
- [ ] 玩家加入/离开
- [ ] 玩家列表展示
- [ ] 玩家状态管理（在线/离线/出局）
- [ ] 玩家身份标识（仅自己可见）

#### 3.2.2 游戏流程控制

**功能描述**：控制游戏各阶段流程

**优先级**：P1（重要）

**阶段管理**：
1. 准备阶段

2. 身份选择阶段
   - [ ] 身份选择界面
   - [ ] 身份统计（不显示具体身份）
   - [ ] 身份提交确认

3. 游戏进行阶段
   - [ ] 场景牌管理（**按顺序揭示**）
   - [ ] **牌面原文展示**（不计算伤害）
   - [ ] 玩家状态更新

4. 结算阶段
   - [ ] **手动结算**（房主点击“结算”按钮）
   - [ ] 胜负判定
   - [ ] 结果展示
   - [ ] 重新开始选项

#### 3.2.3 实时同步

**功能描述**：多玩家数据实时同步

**优先级**：P0（必须）

**功能点**：
- [ ] 玩家状态同步
- [ ] 游戏进度同步
- [ ] 牌面揭示同步
- [ ] 按钮状态同步（例如“揭示”变为“结算”）

#### 3.2.4 用户界面

**功能描述**：提供清晰直观的操作界面

**优先级**：P1（重要）

**界面需求**：
- [ ] 响应式设计（适配手机/平板/电脑）
- [ ] 清晰的信息层级
- [ ] 直观的操作按钮
- [ ] 实时状态反馈
- [ ] **屁牌原文展示区域**（**通过点击大屁牌名称悬浮显示**）

---

## 4. 游戏流程图

### 4.1 完整流程图（文本描述）

游戏流程按以下步骤进行：

1.  **游戏开始**
2.  **身份选择阶段**：玩家选择“乘客”或“屁者”。
3.  **游戏初始化**：生成8张场景牌（4无屁 + 4有屁）。
4.  **游戏进行循环（开始）**：
    * **房主操作（三选一）**：
        * **A. 点击“出局玩家”**：
            * 房主选择一名玩家淘汰。
            * **执行 [立即胜负判定 1]**。
        * **B. 点击“揭示下一牌”**（*仅当4张有屁牌未全部揭示时可用*）：
            * 系统按 1F-8F 顺序揭示一张牌。
            * 牌面显示为“无屁”、“有屁”或“大屁牌名称”。
            * **检查是否4张有屁牌已全部揭示？**
                * **是**： “揭示下一牌”按钮变为“结算”按钮。
                * **否**：返回 [游戏进行循环]。
        * **C. 点击“结算”**（*仅当4张有屁牌全部揭示后可用*）：
            * **执行 [终局胜负判定 2]**。

    * **[立即胜负判定 1]（阵营全灭检查）**：
        * 检查“是否所有乘客都已出局？” -> **是** -> 屁者胜利，**游戏结束**。
        * 检查“是否所有屁者都已出局？” -> **是** -> 乘客胜利，**游戏结束**。
        * **否**：返回 [游戏进行循环]。

    * **[终局胜负判定 2]（按人数检查）**：
        * 检查“存活屁者数量 ≥ 存活乘客数量？”
            * **是** -> 屁者胜利，**游戏结束**。
            * **否** -> 乘客胜利，**游戏结束**。

*( 4.2 场景牌揭示流程 已删除 )*

---

## 5. 技术实现要点

### 5.1 技术栈选择

**前端框架**：Vue 3
- **原因**：已集成到现有项目中
- **优势**：组件化开发，响应式数据管理

**构建工具**：Vite
- **原因**：已集成到现有项目中
- **优势**：快速构建，热重载

**实时同步**：Firebase Realtime Database
- **原因**：现有项目已集成
- **优势**：实时同步，离线支持

**UI框架**：原生CSS / Tailwind CSS
- **建议**：可选择Tailwind CSS加速开发
- **原因**：快速响应式开发

### 5.2 数据模型设计

#### 5.2.1 房间数据模型

```javascript
{
  roomId: "unique_room_id",
  hostId: "player_id",
  gameType: "piZheXianZhi",
  status: "waiting|playing|finished", // 等待/进行中/结束
  createdAt: timestamp,
  currentFloor: 1, // 当前揭示到几楼
  fartCardsRevealedCount: 0, // 已揭示的有屁牌数量
  settings: {
    smallFartCount: number,  // 小屁数量 (0-4)
    bigFartCount: number,    // 大屁数量 (0-4)
    totalFartCards: 4        // 总有屁牌数量（固定）
  }
}
````

#### 5.2.2 玩家数据模型

```javascript
{
  playerId: "unique_player_id",
  name: "玩家名称",
  role: "host|player",  // 房主/玩家
  identity: "passenger|assassin",  // 乘客/屁者
  status: "alive|out",  // 在场/出局
  joinedAt: timestamp,
  isOnline: boolean
}
```

#### 5.2.3 场景牌数据模型

```javascript
{
  floor: number,        // 楼层 1-8
  hasFart: boolean,     // 是否有屁
  cardType: string,     // 卡牌类型
  cardName: string,     // 卡牌中文名称
  cardEffect: string,   // 卡牌效果原文
  revealed: boolean,    // 是否已揭示
  revealedAt: timestamp // 揭示时间
}
```

#### 5.2.4 卡牌效果配置

```javascript
export const CARD_EFFECTS = {
  "无屁": {
    hasFart: false,
    name: "无屁",
    effect: "无效果"
  },
  "有屁": {
    hasFart: true,
    name: "有屁",
    effect: "对所有玩家造成1点伤害"
  },
  "有连环屁": {
    hasFart: true,
    name: "有连环屁",
    effect: "对所有玩家造成1点伤害，若上1张牌为小屁牌，则本次伤害+1，若下1张牌为小屁牌，则该小屁牌伤害+1（相邻牌需为小屁牌）"
  },
  "有蔫儿屁": {
    hasFart: true,
    name: "有蔫儿屁",
    effect: "对所有玩家造成1点伤害，并使下1张无屁牌视为\"对所有玩家造成1点伤害\"的小屁牌。若4张无屁牌均已翻开，则本次伤害不可防御"
  },
  "有臭屁": {
    hasFart: true,
    name: "有臭屁",
    effect: "对所有玩家造成2点伤害"
  },
  "有彩虹屁": {
    hasFart: true,
    name: "有彩虹屁",
    effect: "对所有押牌玩家造成1点不可防御的伤害。对所有空押玩家造成2点伤害"
  },
  "有闷屁": {
    hasFart: true,
    name: "有闷屁",
    effect: "对所有押牌玩家造成1点伤害，对所有空押玩家造成3点伤害"
  }
};
```

### 5.3 核心算法实现

#### 5.3.1 场景牌生成算法

```javascript
/**
 * 生成8张场景牌
 * @param {number} smallFartCount - 小屁数量
 * @param {number} bigFartCount - 大屁数量
 * @returns {Array} 8张场景牌数组
 */
function generateScenarioCards(smallFartCount, bigFartCount) {
  const cards = [];

  // 生成4张无屁牌
  for (let i = 0; i < 4; i++) {
    cards.push({
      floor: 0,  // 待分配
      hasFart: false,
      cardType: "无屁",
      cardName: "无屁",
      cardEffect: "无效果",
      revealed: false
    });
  }

  // 生成小屁牌
  const smallFartTypes = ["有屁"];
  for (let i = 0; i < smallFartCount; i++) {
    const randomType = smallFartTypes[Math.floor(Math.random() * smallFartTypes.length)];
    const cardInfo = CARD_EFFECTS[randomType];
    cards.push({
      floor: 0,
      hasFart: cardInfo.hasFart,
      cardType: randomType,
      cardName: cardInfo.name,
      cardEffect: cardInfo.effect,
      revealed: false
    });
  }

  // 生成大屁牌
  const bigFartTypes = ["有臭屁", "有彩虹屁", "有闷屁", "有连环屁", "有蔫儿屁"];
  for (let i = 0; i < bigFartCount; i++) {
    const randomType = bigFartTypes[Math.floor(Math.random() * bigFartTypes.length)];
    const cardInfo = CARD_EFFECTS[randomType];
    cards.push({
      floor: 0,
      hasFart: cardInfo.hasFart,
      cardType: randomType,
      cardName: cardInfo.name,
      cardEffect: cardInfo.effect,
      revealed: false
    });
  }

  // 随机打乱并分配楼层
  return shuffleAndAssignFloors(cards);
}
```

#### 5.3.2 牌面展示逻辑

```javascript
/**
 * 获取要展示的牌面信息
 * @param {Object} card - 场景牌
 * @param {boolean} isOwnerOrAssassin - 是否为房主或屁者
 * @returns {Object} 展示信息
 */
function getCardDisplayInfo(card, isOwnerOrAssassin) {
  if (!card.revealed && !isOwnerOrAssassin) {
    // 未揭示且无权限：显示隐藏状态
    return {
      visible: false,
      content: "████"
    };
  }

  if (!card.revealed && isOwnerOrAssassin) {
    // 未揭示但有权限：显示内容但不公开
    return {
      visible: false,
      isPrivate: true,
      content: "隐藏",
      cardInfo: {
        name: card.cardName,
        effect: card.cardEffect
      }
    };
  }

  // 已揭示：显示牌面内容
  return {
    visible: true,
    content: card.cardName, // e.g. "无屁", "有连环屁"
    isBigFart: card.hasFart && card.name !== "有屁", // 是否为可点击的大屁
    cardInfo: {
      name: card.cardName,
      effect: card.cardEffect
    }
  };
}
```

#### 5.3.3 胜负判定算法

```javascript
/**
 * 判定游戏是否结束及获胜方
 * @param {Array} players - 所有玩家
 * @param {number} fartCardsRevealedCount - 已揭示的有屁牌数量
 * @param {number} totalFartCards - 总有屁牌数量 (固定为4)
 * @param {string} triggerEvent - 触发判定的事件 ("playerOut" | "checkSettlement")
 * @returns {Object|null} 游戏结果或null
 */
function checkGameEnd(players, fartCardsRevealedCount, totalFartCards, triggerEvent) {
  const alivePlayers = players.filter(p => p.status === "alive");
  const assassinsAlive = alivePlayers.filter(p => p.identity === "assassin").length;
  const passengersAlive = alivePlayers.filter(p => p.identity === "passenger").length;
  
  const allAssassins = players.filter(p => p.identity === "assassin").length;
  const allPassengers = players.filter(p => p.identity === "passenger").length;

  // 判定 1: 阵营全灭（最高优先级，在 playerOut 时检查）
  if (triggerEvent === "playerOut") {
    if (assassinsAlive === 0 && allAssassins > 0) {
      // 所有屁者出局 → 乘客胜利
      return {
        winner: "passengers",
        reason: "所有屁者都已出局",
        revealedAt: Date.now()
      };
    }

    if (passengersAlive === 0 && allPassengers > 0) {
      // 所有乘客出局 → 屁者胜利
      return {
        winner: "assassins",
        reason: "所有乘客都已出局",
        revealedAt: Date.now()
      };
    }
  }

  // 判定 2: 终局结算（在 checkSettlement 时检查）
  // 触发条件：必须是4张有屁牌都已揭示
  if (triggerEvent === "checkSettlement" && fartCardsRevealedCount === totalFartCards) {
    // 所有有屁牌已揭示 → 按数量判定
    if (assassinsAlive >= passengersAlive) {
      return {
        winner: "assassins",
        reason: `终局结算：屁者（${assassinsAlive}人）≥ 乘客（${passengersAlive}人）`,
        revealedAt: Date.now()
      };
    } else {
      return {
        winner: "passengers",
        reason: `终局结算：屁者（${assassinsAlive}人）< 乘客（${passengersAlive}人）`,
        revealedAt: Date.now()
      };
    }
  }

  return null; // 游戏未结束
}
```

-----

## 6. 界面交互要求

### 6.1 整体设计原则

#### 6.1.1 设计风格

  - **风格**：简洁、现代、清晰
  - **色彩**：主色调使用蓝色系，辅助色区分不同状态
  - **字体**：清晰易读的无衬线字体
  - **图标**：使用直观的图标系统

#### 6.1.2 响应式设计

  - **桌面端**（≥1200px）：多列布局，信息展示完整
  - **平板端**（768-1199px）：两列布局，适配触控
  - **手机端**（\<768px）：单列布局，垂直滚动

#### 6.1.3 交互反馈

  - **按钮点击**：有明确的视觉反馈（颜色变化、缩放等）
  - **状态切换**：有平滑的过渡动画
  - **提示**：使用非阻塞式提示（e.g. Toast）

### 6.2 页面布局设计

#### 6.2.1 身份选择页面

```
┌─────────────────────────────────────────┐
│  桌游助手 - 屁者先知                      │
│                                         │
│  ┌─────────────────┐  ┌───────────────┐ │
│  │  玩家列表        │  │  我的身份选择  │ │
│  │                 │  │               │ │
│  │ [房主] 张三     │  │  ○ 乘客       │ │
│  │      在线 ✓     │  │  ○ 屁者       │ │
│  │                 │  │               │ │
│  │     李四        │  │  [确认选择]   │ │
│  │      在线 ✓     │  │               │ │
│  │                 │  └───────────────┘ │
│  │     王五        │                    │
│  │      在线 ✓     │  ┌───────────────┐ │
│  │                 │  │  等待其他玩家 │ │
│  └─────────────────┘  │   选择身份...  │ │
│                       └───────────────┘ │
│                                         │
│  身份统计：                             │
│  • 乘客：2人                             │
│  • 屁者：0人                             │
│  • 待选：1人                             │
└─────────────────────────────────────────┘
```

**交互要求**：

  - 身份选择为单选（乘客/屁者）
  - 选择后需要点击"确认选择"按钮
  - 所有人选择完毕后自动进入游戏

#### 6.2.2 游戏进行页面（房主视角）

```
┌─────────────────────────────────────────┐
│  桌游助手 - 屁者先知                      │
│                                         │
│  ┌─────────────────┐ ┌─────────────────┐│
│  │  电梯显示区      │ │   玩家状态区     ││
│  │                 │ │                 ││
│  │ 8F [██]         │ │ [房主] 张三     ││
│  │ 7F [██]         │ │      在线 ✓     ││
│  │ 6F [██]         │ │                 ││
│  │ 5F [有屁]       │ │     李四        ││
│  │ 4F [有连环屁] <-可点击 │ │      在线 ✓     ││
│  │ 3F [无屁]       │ │                 ││
│  │ 2F [无屁]       │ │     王五        ││
│  │ 1F [有臭屁] <-可点击 │ │      在线 ✓     ││
│  │                 │ │                 ││
│  └─────────────────┘ └─────────────────┘│
│                                         │
│  ┌─────────────────────────────────────┐│
│  │         房主操作区                    ││
│  │                                     ││
│  │  [ 揭示下一楼层 (6F) ]              ││
│  │    (4张有屁牌揭示后变为 [ 结算 ])     ││
│  │                                     ││
│  │        [玩家出局]                    ││
│  │                                     ││
│  └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

**交互要求**：

  * 房主有\*\*单一的“揭示下一楼层”\*\*按钮。
  * 按钮文本动态更新（例如，揭示 5F 后，按钮变为 "揭示下一楼层 (6F)"）。
  * **当第4张有屁牌被揭示后，“揭示下一楼层”按钮将变为“结算”按钮。在点击“结算”前，房主仍可使用“玩家出局”按钮。**
  * **已揭示**的楼层显示：'无屁' / '有屁' / '大屁牌名称' (如 '有连环屁')。
  * **大屁牌名称** (如 '有连环屁') 所有人均可点击，点击后弹出悬浮窗显示完整卡牌效果。
  * 牌未揭示的楼层显示██。
  * "玩家出局"按钮点击后弹出玩家选择列表。
  * **点击“结算”按钮将触发终局胜负判定（按人数对比）。**

#### 6.2.3 游戏进行页面（屁者视角）

```
┌─────────────────────────────────────────┐
│  桌游助手 - 屁者先知                      │
│                                         │
│  ┌─────────────────┐ ┌─────────────────┐│
│  │  电梯显示区      │ │   玩家状态区     ││
│  │                 │ │                 ││
│  │ 8F [██]         │ │ [房主] 张三     ││
│  │ 7F [██]         │ │      在线 ✓     ││
│  │ 6F [██]         │ │                 ││
│  │ 5F [有屁]       │ │     李四        ││
│  │ 4F [有连环屁] <-可点击 │ │      在线 ✓     ││
│  │ 3F [无屁]       │ │                 ││
│  │ 2F [无屁]       │ │     王五        ││
│  │ 1F [有臭屁] <-可点击 │ │      在线 ✓     ││
│  │                 │ │                 ││
│  └─────────────────┘ └─────────────────┘│
│                                         │
│  ┌─────────────────────────────────────┐│
│  │          [查看牌库] 👁               ││
│  └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

**交互要求**：

  * 普通玩家界面相同，但无房主操作按钮。
  * **屁者**身份有单独的"查看牌库"入口（眼睛图标）。
  * **点击"查看牌库"后**：
      * "电TA显示区"**临时**显示所有8张牌的真实内容（无论是否已揭示）。
      * "查看牌库"按钮变为 **[看完了]**。
  * **点击"看完了"后**：
      * "电梯显示区"恢复为正常游戏状态（仅显示已由房主揭示的牌）。
      * "[看完了]"按钮变回 **[查看牌库] 👁**。
  * **所有玩家**均可点击已揭示的**大屁牌名称**查看效果。

#### 6.2.4 玩家出局选择弹窗（房主专用）

```
┌─────────────────────────────────────────┐
│            选择要出局的玩家               │
│                                         │
│  ┌─────────────────────────────────────┐│
│  │ ○ 张三                               ││
│  │ ○ 李四                               ││
│  │ ○ 王五                               ││
│  │                                     ││
│  └─────────────────────────────────────┘│
│                                         │
│      [取消]           [确认出局]         │
└─────────────────────────────────────────┘
```

**交互要求**：

  - 不可选择已出局的玩家
  - 确认出局前有警告提示："确认让XXX出局？此操作不可撤销！"
  - 出局后该玩家状态更新为"已出局"

#### 6.2.5 游戏结算页面

```
┌─────────────────────────────────────────┐
│            游戏结束！                    │
│                                         │
│  ┌─────────────────────────────────────┐│
│  │                                      ││
│  │         屁者胜利！                    ││
│  │                                      ││
│  │      胜利条件：                       ││
│  │   终局结算                            ││
│  │   屁者（2人）≥ 乘客（1人）            ││
│  │                                      ││
│  └─────────────────────────────────────┘│
│                                         │
│  ┌─────────────────────────────────────┐│
│  │           玩家身份                    ││
│  │                                      ││
│  │ 房主 张三        - 乘客（存活）       ││
│  │     李四         - 屁者（存活）       ││
│  │     王五         - 乘客（出局）       ││
│  │                                      ││
│  └─────────────────────────────────────┘│
│                                         │
│              [再来一局]                   │
│                                         │
│              [返回大厅]                   │
└─────────────────────────────────────────┘
```

### 6.3 状态指示器

#### 6.3.1 玩家状态

  - **在线状态**：绿色圆点●
  - **出局状态**：灰色圆点○并显示"[已出局]"标识

#### 6.3.2 场景牌状态

  - **[██]**：未揭示（所有玩家可见）
  - **[无屁]**：已揭示（所有玩家可见）
  - **[有屁]**：已揭示（所有玩家可见）
  - **[大屁牌名称]**：已揭示（所有玩家可见，**可点击查看效果**）

### 6.4 动画效果

#### 6.4.1 电梯揭示动画

  - 楼层按键点击后，该楼层闪烁
  - 牌面翻转动画（0.5秒）
  - 牌面内容淡入显示

#### 6.4.2 按钮交互

  - 鼠标悬停：按钮轻微放大（1.05倍）
  - 点击时：按钮缩小（0.95倍）
  - 禁用状态：按钮变灰，无交互

### 6.5 响应式适配

#### 6.5.1 桌面端（≥1200px）

  - 电梯显示区：1列8行布局
  - 玩家状态区：垂直列表
  - 房主操作区：垂直布局

#### 6.5.2 手机端（\<768px）

  - 电梯显示区：1列8行布局
  - 玩家状态区：卡片式布局
  - 房主操作区：垂直布局

-----

## 7. 非功能需求

### 7.1 性能要求

  - **页面加载时间**：≤ 2秒
  - **操作响应时间**：≤ 500ms
  - **实时同步延迟**：≤ 200ms
  - **支持并发玩家**：2-8人
  - **数据同步频率**：实时（Firebase Realtime Database）

### 7.2 兼容性要求

  - **浏览器支持**：
      - Chrome ≥ 90
      - Safari ≥ 14
      - Firefox ≥ 88
      - Edge ≥ 90
  - **设备支持**：
      - 桌面端：Windows/macOS
      - 移动端：iOS ≥ 14 / Android ≥ 10
      - 平板端：iPad/Android Tablet

### 7.3 可用性要求

  - **易学性**：新用户5分钟内理解游戏流程
  - **易用性**：操作直观，无需额外学习
  - **可访问性**：
      - 支持键盘导航
      - 高对比度模式

### 7.4 可靠性要求

  - **可用性**：99.5%+
  - **数据安全**：
      - Firebase安全规则
      - 身份验证（可选）
      - 数据备份
  - **容错性**：
      - 网络断开自动重连
      - 异常状态自动恢复

### 7.5 安全要求

  - **数据保护**：不存储敏感信息
  - **权限控制**：
      - 房主权限隔离
      - 玩家身份保密
  - **输入验证**：所有用户输入进行验证和清理

-----

## 8. 验收标准

### 8.1 功能验收

| 功能点 | 验收标准 | 测试方法 |
|--------|----------|----------|
| 房间创建 | 生成唯一房间ID，可正常分享 | 创建房间，检查ID唯一性 |
| 身份选择 | 玩家可选择身份，所有人选择后进入游戏 | 测试所有组合 |
| 卡牌生成 | 8张牌正确生成，小屁/大屁数量符合设定 | 多次生成，验证比例 |
| **牌面原文展示** | **点击大屁牌名称可正确显示原文** | **手动验证每种大屁牌** |
| 胜负判定 | **按优先级正确判定胜负** | **构造阵营全灭、点击结算等场景** |
| 特殊权限 | 房主和屁者权限正确隔离 | 切换不同身份测试 |
| **顺序揭示** | **房主只能按 1F-\>8F 顺序揭示** | **测试揭示按钮功能** |
| **结算按钮** | **‘结算’按钮在第4张有屁牌揭示后正确出现，并能正确触发终局判定** | **测试揭示流程** |
| **屁者查看** | **“查看牌库”按钮能正确临时揭示，并能“看完了”恢复** | **使用屁者身份测试** |

### 8.2 性能验收

  - 页面加载时间测试：记录加载时间
  - 操作响应时间测试：记录每步操作耗时
  - 并发测试：模拟8人同时在线

### 8.3 兼容性验收

  - 浏览器测试：各主流浏览器功能正常
  - 设备测试：手机/平板/电脑界面适配

### 8.4 验收流程

1.  **开发自测**：开发完成后自行测试
2.  **团队内测**：团队成员参与测试
3.  **功能验收**：对照验收标准逐项测试
4.  **性能验收**：性能指标测试
5.  **用户验收**：模拟真实游戏场景测试

-----

## 9. 项目计划

### 9.1 开发阶段

| 阶段 | 任务 | 预计时间 |
|------|------|----------|
| **阶段1** | 基础架构搭建（Vue组件、路由） | 1天 |
| **阶段2** | 房间管理（创建、加入、设置） | 1天 |
| **阶段3** | 身份选择功能 | 0.5天 |
| **阶段4** | 场景牌系统（生成、展示、原文显示） | 1.5天 |
| **阶段5** | F房主特殊功能（揭示、出局、结算） | 1天 |
| **阶段6** | 屁者特殊功能（**新版查看牌库**） | 0.5天 |
| **阶段7** | 胜负判定系统（双重判定） | 0.5天 |
| **阶段8** | UI优化与适配（**移除退出按钮等**） | 1天 |

**总计**：约7个工作日

### 9.2 里程碑

  - **M1**：基础框架完成
  - **M2**：核心功能完成
  - **M3**：所有功能完成
  - **M4**：测试通过，可发布

-----

## 10. 风险与应对

### 10.1 技术风险

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| Firebase连接不稳定 | 游戏中断 | 实现离线缓存，网络恢复后同步 |
| 实时同步延迟高 | 体验差 | 优化数据同步策略，减少不必要的同步 |
| 移动端性能不足 | 卡顿 | 优化代码，减少不必要的渲染 |

### 10.2 产品风险

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 游戏规则理解困难 | 用户流失 | 提供详细的新手引导 |
| 身份泄露 | 破坏游戏公平性 | 严格权限控制，身份数据加密 |
| 胜负判定错误 | 游戏体验差 | 全面测试各种场景，建立测试用例 |

### 10.3 应对策略

1.  **提前验证**：关键技术点提前原型验证
2.  **迭代开发**：MVP先行，逐步完善
3.  **充分测试**：建立测试用例
4.  **用户反馈**：发布beta版收集用户反馈

-----

## 11. 附录

### 11.1 术语表

| 术语 | 定义 |
|------|------|
| **桌游助手** | 本产品名称，网页端桌游主持人工具 |
| **屁者先知** | 目标游戏名称 |
| **房主** | 游戏创建者和最高权限玩家 |
| **屁者** | 游戏中的特殊身份玩家 |
| **乘客** | 游戏中的普通身份玩家 |
| **场景牌** | 8张电梯楼层对应的牌面 |
| **无屁牌** | 不造成伤害的牌（4张） |
| **小屁牌** | 有屁牌 |
| **大屁牌** | 除有屁牌以外的特殊屁牌 |
| **揭示** | 房主点击按钮显示牌面内容 |
| **屁牌原文** | **卡牌效果的中文描述文本** |

### 11.2 参考资料

  - Vue 3官方文档：https://vuejs.org/
  - Firebase Realtime Database文档：https://firebase.google.com/docs/database
  - 游戏规则：玩家提供的原始规则文档

